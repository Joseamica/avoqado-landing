---
import { Image } from 'astro:assets';
import MobileMenu from '../interactive/MobileMenu';
import DemoButton from '../interactive/DemoButton';

interface Props {
	position?: 'fixed' | 'absolute';
    transparentOnTop?: boolean;
}

const { position = 'fixed', transparentOnTop = false } = Astro.props;

// Base classes that are always present
const baseClasses = "top-0 left-0 right-0 z-[300] transition-all duration-300";

// Classes for the "solid/scrolled" state
const solidClasses = "bg-[#0A0A0A] md:bg-black/80 md:backdrop-blur-md border-b border-gray-800";

// Classes for the "transparent/top" state
const transparentClasses = "bg-transparent border-transparent";

// Initial class determination (server-side)
// If transparentOnTop is true, start transparent (client script handles scroll)
// If false, start solid.
const initialClasses = transparentOnTop ? transparentClasses : solidClasses;
---

<nav 
    id="main-navbar"
    data-transparent-on-top={transparentOnTop.toString()}
    class:list={[baseClasses, initialClasses, position, "group"]}
>
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
		<div class="flex justify-between items-center h-16">
			<!-- Logo -->
			<div class="flex items-center">
				<a href="/" class="flex items-center space-x-2 focus:outline-none">
					<Image 
                        src="/imagotipo-white.png" 
                        alt="Avoqado Logo" 
                        class="h-10 w-auto group-[.white-nav]:hidden transition-all duration-300" 
                        width={200} 
                        height={40} 
                        priority 
                    />
                    <Image 
                        src="/imagotipo.png" 
                        alt="Avoqado Logo" 
                        class="h-10 w-auto hidden group-[.white-nav]:block transition-all duration-300" 
                        width={200} 
                        height={40} 
                        priority 
                    />
				</a>
			</div>

			<!-- Desktop Navigation -->
			<div class="hidden lg:flex items-center gap-6">
				<div id="nav-center-links" class="flex items-center space-x-8 transition-opacity duration-300">
				<div id="mega-menu-trigger" class="relative group/menu">
						<!-- Trigger with extended hover area -->
						<button class="text-gray-300 hover:text-white group-hover/menu:text-white group-[.white-nav]:text-gray-700 group-[.white-nav]:hover:text-black transition-colors focus-visible:text-avoqado-green flex items-center cursor-pointer py-5">
							Tipos de negocios
							<svg class="w-3 h-3 ml-1 transition-transform group-hover/menu:rotate-180" style="width: 12px; height: 12px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
						</button>
						
						<!-- Invisible bridge to prevent hover gap -->
						<div class="absolute left-0 w-full h-4 top-full"></div>
						
						<!-- Mega Menu Dropdown -->
						<div class="fixed top-16 left-0 w-full bg-white text-black origin-top scale-y-0 group-hover/menu:scale-y-100 transition-transform duration-300 ease-out border-b border-gray-100 shadow-xl z-50">
							<div class="max-w-7xl mx-auto px-10 sm:px-12 lg:px-14 py-12">
								<div class="flex flex-col items-start gap-4">
									<a href="/restaurants" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 hover:from-avoqado-green hover:to-green-600 transition-all duration-300">
										Alimentos y bebidas
									</a>
									<a href="/retail" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 hover:from-avoqado-green hover:to-green-600 transition-all duration-300">
										Tienda
									</a>
									<a href="/beauty" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 hover:from-avoqado-green hover:to-green-600 transition-all duration-300">
										Belleza
									</a>
									<a href="/services" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 hover:from-avoqado-green hover:to-green-600 transition-all duration-300">
										Servicios
									</a>
									
									<div class="h-px w-32 bg-gray-200 my-2"></div>
									
									<a href="/#industries" class="text-base font-medium text-gray-500 hover:text-black transition-colors flex items-center group/link">
										Todos los tipos de negocio
										<svg class="w-4 h-4 ml-1 transform group-hover/link:translate-x-1 transition-transform" style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
									</a>
								</div>
							</div>
						</div>
					</div>
					<div id="products-menu-trigger" class="relative group/products">
						<!-- Trigger with extended hover area -->
						<button class="text-gray-300 hover:text-white group-hover/products:text-white group-[.white-nav]:text-gray-700 group-[.white-nav]:hover:text-black transition-colors focus-visible:text-avoqado-green flex items-center cursor-pointer py-5">
							Productos
							<svg class="w-3 h-3 ml-1 transition-transform group-hover/products:rotate-180" style="width: 12px; height: 12px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
						</button>
						
						<!-- Invisible bridge to prevent hover gap -->
						<div class="absolute left-0 w-full h-4 top-full"></div>
						
						<!-- Products Mega Menu Dropdown -->
						<div class="fixed top-16 left-0 w-full bg-white text-black origin-top scale-y-0 group-hover/products:scale-y-100 transition-transform duration-300 ease-out border-b border-gray-100 shadow-xl z-50">
							<div class="max-w-7xl mx-auto px-10 sm:px-12 lg:px-14 py-12">
								<div class="flex flex-col items-start gap-4">
									<a href="/productos/hardware" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 hover:from-avoqado-green hover:to-green-600 transition-all duration-300">
										Hardware
									</a>
									<a href="/productos/pagos" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 hover:from-avoqado-green hover:to-green-600 transition-all duration-300">
										Pagos
									</a>
									<a href="/productos/clientes" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 hover:from-avoqado-green hover:to-green-600 transition-all duration-300">
										Clientes
									</a>
									<a href="/productos/personal" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 hover:from-avoqado-green hover:to-green-600 transition-all duration-300">
										Personal
									</a>
									<a href="/productos/banca" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600 hover:from-avoqado-green hover:to-green-600 transition-all duration-300">
										Banca
									</a>
									
									<div class="h-px w-32 bg-gray-200 my-2"></div>
									
									<a href="/productos" class="text-base font-medium text-gray-500 hover:text-black transition-colors flex items-center group/link">
										Todos los productos
										<svg class="w-4 h-4 ml-1 transform group-hover/link:translate-x-1 transition-transform" style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
									</a>
								</div>
							</div>
						</div>
					</div>
					<a href="/#solutions" class="text-gray-300 hover:text-white group-[.white-nav]:text-gray-700 group-[.white-nav]:hover:text-black transition-colors focus-visible:text-avoqado-green">
						Soluciones
					</a>
					<a href="/pricing" class="text-gray-300 hover:text-white group-[.white-nav]:text-gray-700 group-[.white-nav]:hover:text-black transition-colors focus-visible:text-avoqado-green">
						Precios
					</a>
				</div>
				<div class="flex items-center gap-3">
					<a
						href="https://dashboard.avoqado.io"
						class="px-5 py-2.5 border border-white/30 text-white rounded-full hover:bg-white/10 hover:border-white/50 transition-all font-medium group-[.white-nav]:bg-black group-[.white-nav]:text-white group-[.white-nav]:border-black group-[.white-nav]:hover:bg-gray-800"
					>
						Iniciar sesi√≥n
					</a>
					<DemoButton client:load />
				</div>
			</div>

			<!-- Mobile Menu Component -->
			<MobileMenu client:load />
		</div>
	</div>
</nav>

<style>
	/* Demo button state changes based on navbar */
	.white-nav .demo-btn {
		background-color: black !important;
		color: white !important;
	}
	.white-nav .demo-btn:hover {
		background-color: #1f1f1f !important;
	}
</style>

<script>
    const navbar = document.getElementById('main-navbar');
    const navLinks = document.getElementById('nav-center-links');
    const megaMenuTrigger = document.getElementById('mega-menu-trigger');
    const productsMenuTrigger = document.getElementById('products-menu-trigger');

    if (navbar && navbar.dataset.transparentOnTop === 'true') {
        const transparentClasses = ["bg-transparent", "border-transparent"];
        const whiteClasses = ["bg-white/95", "backdrop-blur-md", "border-b", "border-gray-200", "shadow-sm", "white-nav"];

        let isMegaMenuOpen = false;

        const updateNavbar = () => {
             if (isMegaMenuOpen || window.scrollY > 50) {
                // Mega menu open OR scrolled: White navbar
                navbar.classList.remove(...transparentClasses);
                navbar.classList.add(...whiteClasses);
                if (navLinks && window.scrollY > 50 && !isMegaMenuOpen) {
                    navLinks.classList.add('opacity-0', 'pointer-events-none');
                    navLinks.classList.remove('opacity-100');
                } else if (navLinks) {
                    navLinks.classList.remove('opacity-0', 'pointer-events-none');
                    navLinks.classList.add('opacity-100');
                }
            } else {
                // At top, no menu: Transparent dark navbar
                navbar.classList.remove(...whiteClasses);
                navbar.classList.add(...transparentClasses);
                if (navLinks) {
                    navLinks.classList.remove('opacity-0', 'pointer-events-none');
                    navLinks.classList.add('opacity-100');
                }
            }
        };

        // Mega menu hover listeners (Tipos de negocios)
        if (megaMenuTrigger) {
            megaMenuTrigger.addEventListener('mouseenter', () => {
                isMegaMenuOpen = true;
                updateNavbar();
            });
            megaMenuTrigger.addEventListener('mouseleave', () => {
                isMegaMenuOpen = false;
                updateNavbar();
            });
        }

        // Products menu hover listeners
        if (productsMenuTrigger) {
            productsMenuTrigger.addEventListener('mouseenter', () => {
                isMegaMenuOpen = true;
                updateNavbar();
            });
            productsMenuTrigger.addEventListener('mouseleave', () => {
                isMegaMenuOpen = false;
                updateNavbar();
            });
        }

        // Run once on load
        updateNavbar();

        // Listen for scroll
        window.addEventListener('scroll', updateNavbar, { passive: true });
    }
</script>
